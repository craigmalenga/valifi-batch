<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0"/>
  <title>Credit Report Service</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <form id="searchForm" autocomplete="on" novalidate>
      <!-- Progress Indicator -->
      <div class="progress-bar">
        <div class="progress-step active" data-step="1">Personal Info</div>
        <div class="progress-step" data-step="2">Address</div>
        <div class="progress-step" data-step="3">Mobile</div>
        <div class="progress-step" data-step="4">Verify OTP</div>
        <div class="progress-step" data-step="mobileid">Trust Check</div>
        <div class="progress-step" data-step="identity">Identity</div>
        <div class="progress-step" data-step="5">Submit</div>
      </div>

      <!-- === STEP 1: Personal Info === -->
      <div class="form-step" id="step1">
        <h2 class="section-heading">Ready to Roll? Who Financed the Vehicle?</h2>
        
        <div class="form-group">
          <label>Title *</label>
          <div class="title-button-group" id="title_buttons">
            <button type="button" data-value="Mr">Mr</button>
            <button type="button" data-value="Mrs">Mrs</button>
            <button type="button" data-value="Miss">Miss</button>
            <button type="button" data-value="Ms">Ms</button>
            <button type="button" data-value="Other">Other</button>
          </div>
          <input type="hidden" id="title" name="title" required />
          <span class="error-message" id="title_error"></span>
        </div>

        <div class="form-group">
          <label for="first_name">First Name (as on documents) *</label>
          <input type="text" id="first_name" required autocomplete="given-name">
          <span class="error-message" id="first_name_error"></span>
        </div>

        <div class="form-group">
          <label for="middle_name">Middle Name(s) – optional</label>
          <input type="text" id="middle_name" autocomplete="additional-name">
        </div>

        <div class="form-group">
          <label for="last_name">Last Name *</label>
          <input type="text" id="last_name" required autocomplete="family-name">
          <span class="error-message" id="last_name_error"></span>
        </div>
        
        <div class="form-group">
          <label for="dob_day">Date of Birth *</label>
          <div class="dob-container">
            <select id="dob_day" required>
              <option value="">Day</option>
            </select>
            <select id="dob_month" required>
              <option value="">Month</option>
            </select>
            <input type="text" id="dob_year" placeholder="YYYY" maxlength="4" required pattern="\d{4}" />
          </div>
          <span class="error-message" id="dob_error"></span>
        </div>

        <div class="form-group">
          <label for="email">Email Address *</label>
          <input type="email" id="email" name="email" required autocomplete="email" />
          <span class="error-message" id="email_error"></span>
        </div>

        <div class="button-row">
          <button type="button" class="button-left" id="clear_step1">Clear Data</button>
          <button type="button" class="button-right" id="next_to_step2">Proceed</button>
        </div>
      </div>

      <!-- === STEP 2: Address === -->
      <div class="form-step" id="step2" style="display:none;">
        <h2 class="step-title">What's your address?</h2>

        <div class="postcode-lookup">
          <input type="text" id="lookup_postcode" placeholder="Enter postcode…" autocomplete="postal-code" />
          <button type="button" class="button-right" id="address_lookup_btn">Find Address</button>
        </div>

        <div id="address_container" style="display:none;">
          <label for="address_select">Select Address</label>
          <select id="address_select" name="address_select">
            <option value="">Pick an address…</option>
          </select>
        </div>

        <div id="address_error" class="error-message"></div>

        <div class="address-fields">
          <div class="form-group">
            <label for="flat">Flat / Unit</label>
            <input type="text" id="flat" name="flat" placeholder="e.g. 1" autocomplete="address-line1"/>
          </div>
          <div class="form-group">
            <label for="street">Street *</label>
            <input type="text" id="street" name="street" placeholder="e.g. Example Street" required autocomplete="address-line2"/>
            <span class="error-message" id="street_error"></span>
          </div>
          <div class="form-group">
            <label for="post_town">Post Town *</label>
            <input type="text" id="post_town" name="postTown" placeholder="e.g. TEST TOWN" required autocomplete="address-level2"/>
            <span class="error-message" id="post_town_error"></span>
          </div>
          <div class="form-group">
            <label for="post_code">Post Code *</label>
            <input type="text" id="post_code" name="postCode" placeholder="e.g. AB1 2CD" required autocomplete="postal-code"/>
            <span class="error-message" id="post_code_error"></span>
          </div>
        </div>

        <div class="button-row">
          <button type="button" class="button-left" id="back_to_step1">Go Back</button>
          <button type="button" class="button-right" id="next_to_step3">Proceed</button>
        </div>
      </div>

      <!-- === STEP 3: Mobile Entry === -->
      <div class="form-step" id="step3" style="display:none;">
        <h2 class="step-title">Mobile Verification</h2>

        <div class="form-group">
          <label for="mobile">Mobile Number *</label>
          <input type="tel" id="mobile" name="mobile" required autocomplete="tel" placeholder="07XXX XXXXXX">
          <span class="error-message" id="mobile_error"></span>
        </div>
        
        <button type="button" class="button-primary full-width" id="send_otp">Send OTP</button>
        <div id="otp_message" class="info-message" style="display:none;"></div>

        <div class="button-row">
          <button type="button" class="button-left" id="back_to_step2">Go Back</button>
          <button type="button" class="button-right" id="next_to_step4" disabled>Proceed</button>
        </div>
      </div>

      <!-- === STEP 4: OTP Verification === -->
      <div class="form-step" id="step4" style="display:none;">
        <h2 class="step-title">Verify OTP Code</h2>

        <div class="form-group" id="otp_group">
          <label for="otp">Enter OTP *</label>
          <input type="text" id="otp" name="otp" autocomplete="one-time-code" inputmode="numeric" maxlength="6" placeholder="XXXXXX">
          <span class="error-message" id="otp_error"></span>
        </div>
        
        <button type="button" class="button-primary full-width" id="verify_otp">Verify OTP</button>
        <div id="otp_status" class="status-message"></div>

        <div class="button-row">
          <button type="button" class="button-left" id="back_to_step3">Go Back</button>
          <button type="button" class="button-right" id="next_to_stepMobileId" disabled>Proceed</button>
        </div>
      </div>

      <!-- === NEW STEP: MobileID Trust Assessment === -->
      <div class="form-step" id="stepMobileId" style="display:none;">
        <h2 class="step-title">Trust & Security Check</h2>
        <p class="step-description">
          We're now verifying that your mobile number is securely associated with your identity. 
          This helps protect against fraud and ensures your information is safe.
        </p>
        
        <div class="trust-check-container">
          <button type="button" class="button-primary full-width" id="check_mobile_trust">
            Verify Mobile Trust
          </button>
          
          <div id="trust_status" class="trust-status-container" style="display:none;">
            <div class="trust-indicator">
              <span class="trust-icon"></span>
              <span class="trust-text"></span>
            </div>
            
            <div class="trust-details" style="display:none;">
              <h4>Trust Assessment Details:</h4>
              <ul id="trust_details_list"></ul>
            </div>
            
            <div class="trust-warning" id="trust_warning" style="display:none;">
              <strong>⚠️ Security Alert:</strong>
              <p id="trust_warning_text"></p>
            </div>
          </div>
        </div>
        
        <div class="button-row">
          <button type="button" class="button-left" id="back_to_step4_from_mobile">Go Back</button>
          <button type="button" class="button-right" id="next_to_stepIdentity_from_mobile" disabled>Proceed</button>
        </div>
      </div>

      <!-- === STEP 4.5: Proof of Identity === -->
      <div class="form-step" id="stepIdentity" style="display:none;">
        <h2 class="step-title">Proof of Identity</h2>
        <p class="step-description">Please confirm your identity by validating your details.</p>
        
        <button type="button" class="button-primary full-width" id="verify_identity">Verify Identity</button>
        <div id="identity_status" class="status-message"></div>
        
        <div class="button-row">
          <button type="button" class="button-left" id="back_to_stepMobileId">Go Back</button>
          <button type="button" class="button-right" id="next_to_step5" disabled>Proceed</button>
        </div>
      </div>

      <!-- === STEP 5: Submit Final === -->
      <div class="form-step" id="step5" style="display:none;">
        <h2 class="step-title">Review and Submit</h2>
        
        <div class="review-summary" id="review_summary">
          <!-- Populated by JS -->
        </div>

        <p class="step-description">Click below to retrieve your credit report.</p>

        <div class="button-row">
          <button type="button" class="button-left" id="back_to_stepIdentity">Go Back</button>
          <button type="submit" class="button-right">Get Report</button>
        </div>
      </div>

      <!-- === STEP 6: What we've found === -->
      <div class="form-step" id="step6" style="display:none;">
        <h2 class="section-heading">Here's what our checks have already found</h2>
        
        <div id="found_list" class="lenders-list">
          <!-- JS will inject lender items here -->
        </div>
        
        <button type="button" class="button-primary full-width" id="add_lender_btn">
          Click here to add additional lenders if you believe our initial checks missed anything.
        </button>
        
        <p class="info-note">
          Don't worry if you can't recall any details. In addition to the live checks we have just carried out, 
          going back up to 7 years, we will run additional checks in the next 24 hours to go back through more 
          historic contracts on your behalf. We will be in touch to discuss the outcome of any further matches.
        </p>
      </div>

    </form>
    
    <!-- Loading Overlay -->
    <div id="loading_overlay" class="loading-overlay" style="display:none;">
      <div class="spinner"></div>
      <div class="loading-text">Processing...</div>
    </div>
    
    <!-- Results & Debug -->
    <div id="result" class="result-container" style="display:none;"></div>
    <div id="flg_status" class="status-container"></div>
    <div id="debug_container" class="debug-container" style="display:none;"></div>
  </div>

  <script src="/static/js/app.js"></script>
</body>
</html>